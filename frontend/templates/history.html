
{% extends "layout.html" %}
{% block content %}
<div class="max-w-5xl mx-auto py-10 px-4">
  <h2 class="text-3xl font-bold text-blue-700 mb-6 text-center">Prediction History</h2>

  {% if predictions %}
    <table class="min-w-full bg-white shadow-md rounded-lg overflow-hidden">
      <thead class="bg-blue-600 text-white">
        <tr>
          <th class="py-3 px-4 text-left">Date</th>
          <th class="py-3 px-4 text-left">Label</th>
          <th class="py-3 px-4 text-left">Confidence</th>
          <th class="py-3 px-4 text-left">Image</th>
          <th class="py-3 px-4 text-left">Grad-CAM</th>
        </tr>
      </thead>
      <tbody class="text-gray-700">
        {% for pred in predictions %}
        <tr class="border-b">
          <td class="py-3 px-4">{{ pred.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
          <td class="py-3 px-4">{{ pred.label }}</td>
          <td class="py-3 px-4">{{ pred.confidence|round(3) }}</td>
          <td class="py-3 px-4">
            <img src="{{ url_for('uploaded_file', filename='images/' + pred.image_path) }}"
       alt="Image"
       class="h-20 rounded border cursor-pointer hover:scale-105 transition"
       onclick="showModal('{{ url_for('uploaded_file', filename='images/' + pred.image_path) }}')">
          <td class="py-3 px-4">
          <img src="{{ url_for('uploaded_file', filename='gradcams/' + pred.gradcam_path) }}"
              alt="Grad-CAM"
              class="h-20 rounded border cursor-pointer hover:scale-105 transition"
              onclick="showModal('{{ url_for('uploaded_file', filename='gradcams/' + pred.gradcam_path) }}')">
        </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="mt-6 text-center">
      {% if predictions.has_prev %}
        <a href="{{ url_for('history', page=predictions.prev_num) }}" class="px-3 py-1 bg-blue-200 hover:bg-blue-300 rounded mr-2">Previous</a>
      {% endif %}
      {% if predictions.has_next %}
        <a href="{{ url_for('history', page=predictions.next_num) }}" class="px-3 py-1 bg-blue-200 hover:bg-blue-300 rounded">Next</a>
      {% endif %}
    </div>

  {% else %}
    <p class="text-center text-gray-600">No prediction history available.</p>
  {% endif %}
</div>

<!-- Image Modal -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
  <div class="relative bg-white rounded-lg shadow-lg max-w-4xl w-full p-4">
    <button onclick="closeModal()" class="absolute top-2 right-4 text-2xl font-bold text-gray-700 hover:text-red-600">
      &times;
    </button>
    <img id="modalImage" src="" class="w-full rounded-lg max-h-[80vh] object-contain" />
  </div>
</div>

<script>
  function showModal(imageUrl) {
    document.getElementById("modalImage").src = imageUrl;
    document.getElementById("imageModal").classList.remove("hidden");
  }

  function closeModal() {
    document.getElementById("modalImage").src = "";
    document.getElementById("imageModal").classList.add("hidden");
  }
</script>

{% endblock %}
